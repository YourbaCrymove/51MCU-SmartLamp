C51 COMPILER V9.54   XPT2046                                                               10/23/2025 21:58:00 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE XPT2046
OBJECT MODULE PLACED IN .\Objects\xpt2046.obj
COMPILER INVOKED BY: D:\keil_v5\C51\BIN\C51.EXE ..\Driver\xpt2046\xpt2046.c OPTIMIZE(8,SPEED) BROWSE INCDIR(..\Common;..
                    -\Core;..\Driver\keyInput;..\Driver\nixie;..\Driver\timer0;..\Driver\xpt2046) DEBUG OBJECTEXTEND PRINT(.\Listings\xpt2046
                    -.lst) OBJECT(.\Objects\xpt2046.obj)

line level    source

   1          #include "xpt2046.h"
   2          #include "intrins.h"
   3          
   4          /*******************************************************************************
   5          * 函 数 名       : xpt2046_wirte_data
   6          * 函数功能           : XPT2046写数据
   7          * 输    入       : dat：写入的数据
   8          * 输    出             : 无
   9          *******************************************************************************/
  10          void xpt2046_wirte_data(unsigned char dat) {
  11   1              unsigned char i;
  12   1      
  13   1              CLK = 0;
  14   1              _nop_();
  15   1              for(i=0;i<8;i++) {      //循环8次，每次传输一位，共一个字节
  16   2                      DIN = dat >> 7;//先传高位再传低位
  17   2                      dat <<= 1;//将低位移到高位
  18   2                      CLK = 0;//CLK由低到高产生一个上升沿，从而写入数据
  19   2                      _nop_();        
  20   2                      CLK = 1;
  21   2                      _nop_();
  22   2              }
  23   1      }
  24          
  25          /*******************************************************************************
  26          * 函 数 名       : xpt2046_read_data
  27          * 函数功能           : XPT2046读数据
  28          * 输    入       : 无
  29          * 输    出             : XPT2046返回12位数据
  30          *******************************************************************************/
  31          unsigned int    xpt2046_read_data(void) {
  32   1              unsigned char i;
  33   1              unsigned int dat=0;
  34   1      
  35   1              CLK = 0;
  36   1              _nop_();
  37   1              for(i=0;i<12;i++) {     //循环12次，每次读取一位，大于一个字节数，所以返回值类型是
             -u16
  38   2                      dat <<= 1;
  39   2                      CLK = 1;
  40   2                      _nop_();
  41   2                      CLK = 0; //CLK由高到低产生一个下降沿，从而读取数据
  42   2                      _nop_();
  43   2                      dat |= DOUT;//先读取高位，再读取低位。      
  44   2              }
  45   1              return dat;     
  46   1      }
  47          
  48          /*******************************************************************************
  49          * 函 数 名       : xpt2046_read_adc_value
  50          * 函数功能           : XPT2046读AD数据
  51          * 输    入       : cmd：指令
  52          * 输    出             : XPT2046返回AD值
C51 COMPILER V9.54   XPT2046                                                               10/23/2025 21:58:00 PAGE 2   

  53          *******************************************************************************/
  54          unsigned int xpt2046_read_adc_value(unsigned char cmd) {
  55   1              unsigned char i;
  56   1              unsigned int adc_value=0;
  57   1      
  58   1              CLK = 0;//先拉低时钟
  59   1              CS  = 0;//使能XPT2046
  60   1              xpt2046_wirte_data(cmd);//发送命令字
  61   1              for(i=6; i>0; i--);//延时等待转换结果
  62   1              CLK = 1;
  63   1              _nop_();
  64   1              CLK = 0;//发送一个时钟，清除BUSY
  65   1              _nop_();
  66   1              adc_value=xpt2046_read_data();
  67   1              CS = 1;//关闭XPT2046
  68   1              return adc_value;
  69   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     88    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
