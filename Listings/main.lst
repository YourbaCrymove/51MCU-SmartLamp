C51 COMPILER V9.54   MAIN                                                                  10/22/2025 21:42:59 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\keil_v5\C51\BIN\C51.EXE Users\main.c OPTIMIZE(8,SPEED) BROWSE INCDIR(.\Users;.\Driver) DEBUG OBJ
                    -ECTEXTEND PRINT(.\Listings\main.lst) OBJECT(.\Objects\main.obj)

line level    source

   1          /* 头文件包含区域 */
   2          #include "main.h"
   3          #include "keyInput.h"
   4          
   5          /* 变量声明区域 */
   6          lightStatus lightState; // 台灯状态变量
   7          unsigned char lightGrade[5] = {0, 25, 50, 75, 100};     // 台灯等级
   8          unsigned char pwmCount;         // PWM周期计数（0~99，累计100×10μs=1ms）
   9          
  10          systemStatus systemState;       // 用于存储系统所处模式
  11          unsigned char keyNumber;        // 存储按键的值
  12          
  13          bit human;      // 0-表示没人，1-表示有人
  14          
  15          /* 函数声明区域 */
  16          // 系统初始化函数
  17          void systemInit(void) {
  18   1              timer0Init();   // 初始化定时器0
*** WARNING C206 IN LINE 18 OF Users\main.c: 'timer0Init': missing function-prototype
  19   1              updateIndicators();     // 初始化指示灯
  20   1              
  21   1              lightState = LAMP_CLOSE;        // 上电时，台灯默认关闭
  22   1              pwmCount = 0;   // PWM周期计数初始为 0
  23   1              
  24   1              systemState = MANUAL;   // 上电时，系统处于手动模式
  25   1      }
  26          
  27          // 状态机处理函数
  28          // 处理按键输入，控制系统状态切换和台灯挡位修改
  29          void stateMachine(void) {
  30   1              keyNumber = keyRead();
  31   1              switch(keyNumber) {
  32   2                      case 1:         // 系统手动/自动模式切换
  33   2                              systemState =  (systemState==MANUAL)?AUTO:MANUAL;
  34   2                              // 更新指示灯
  35   2                  updateIndicators();
  36   2                              break;
  37   2                      case 2:    // 增加亮度挡位（循环）
  38   2                              if(systemState==MANUAL) {       // 按键2仅在手动模式下有效
  39   3                                      lightState = (lightState + 1) % 5;      // 枚举变量可以使用自增/自减操作
  40   3                              }
  41   2                              break;
  42   2                      case 3:    // 降低亮度挡位（循环）
  43   2                              if(systemState==MANUAL) {       // 按键3仅在手动模式下有效
  44   3                                      lightState = (lightState - 1 + 5) % 5;
  45   3                              }
  46   2                              break;
  47   2                      case 4:         // 用按键4模拟人来
  48   2                              break;
  49   2              }
  50   1      }
  51          
  52          // 指示灯更新函数
  53          void updateIndicators(void) {
C51 COMPILER V9.54   MAIN                                                                  10/22/2025 21:42:59 PAGE 2   

  54   1          LED1 = !(systemState == AUTO);   // 自动模式指示灯
  55   1          LED2 = !(systemState == MANUAL); // 手动模式指示灯
  56   1      }
  57          
  58          
  59          /* Main */
  60          void main() {   
  61   1              systemInit();
  62   1              
  63   1              while(1) {
  64   2                      stateMachine();
  65   2                      
  66   2              }
  67   1      }
  68          
  69          // 定时器0中断服务函数，每10us中断一次
  70          void timer0_ISR(void) interrupt 1 {
  71   1          // 重装载初值，保证每次定时一致
  72   1          TH0 = (65536 - 9) / 256;  
  73   1          TL0 = (65536 - 9) % 256;  
  74   1          
  75   1              pwmCount++;
  76   1          pwmCount %= 100;
  77   1              if(pwmCount < lightGrade[lightState]) {
  78   2                      LED_MAIN = 0;   // 照明灯引脚给 0 亮
  79   2              } else {
  80   2                      LED_MAIN = 1;   // 照明灯引脚给 1 灭
  81   2              }
  82   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    171    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      9    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
